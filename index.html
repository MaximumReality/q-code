<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>THE Q-CODE</title>

<style>
:root{
    --neon-cyan:#00ffff;
    --neon-pink:#ff00ff;
    --corrupted:#ff0055;
}

body{
    margin:0;
    background:#000;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    perspective:1200px;
    font-family:monospace;
    color:var(--neon-cyan);
}

/* STATIC CAMERA */
.scene{
    width:400px;
    height:400px;
    position:relative;
    transform-style:preserve-3d;
    transform: rotateX(60deg) rotateY(0deg);
}

.pyramid{
    position:absolute;
    top:50%;
    left:50%;
    transform-style:preserve-3d;
    transform:translate(-50%,-50%);
}

/* CUBES */
.cube-wrapper{
    position:absolute;
    width:50px;
    height:50px;
    transform-style:preserve-3d;
    transition:transform .3s ease;
}

.cube{
    position:absolute;
    width:50px;
    height:50px;
    backface-visibility:hidden;
}

.top{
    background:var(--corrupted);
    transform:translateZ(50px);
    border:1px solid #fff;
    transition:all .3s ease;
}

.left{
    background:#990033;
    transform:rotateY(-90deg) translateZ(25px);
    transform-origin:left;
}

.right{
    background:#660022;
    transform:rotateX(-90deg) translateZ(25px);
    transform-origin:bottom;
}

/* GLOW PULSE */
.compiled .top{
    background:var(--neon-cyan)!important;
    animation: pulse 1.2s infinite ease-in-out;
}

@keyframes pulse{
    0%{ box-shadow:0 0 10px var(--neon-cyan); }
    50%{ box-shadow:0 0 35px var(--neon-cyan); }
    100%{ box-shadow:0 0 10px var(--neon-cyan); }
}
    /* GLITCH PHASE */
.glitch .top{
    animation: glitchFlicker 0.25s steps(2) 4;
}

@keyframes glitchFlicker{
    0%{
        background:#ff0055;
        box-shadow:0 0 5px #ff0055;
        transform:translateZ(50px) translateX(0);
    }
    25%{
        background:#00ff88;
        transform:translateZ(50px) translateX(-3px);
    }
    50%{
        background:#ffffff;
        transform:translateZ(50px) translateX(3px);
    }
    75%{
        background:#ff00ff;
        transform:translateZ(50px) translateX(-2px);
    }
    100%{
        background:#ff0055;
        transform:translateZ(50px) translateX(0);
    }
}

/* AZUL FIXED */
#azul{
    position:absolute;
    width:40px; /* smaller */
    pointer-events:none;
    transition:transform .3s cubic-bezier(.2,1,.3,1);
}
</style>
</head>
<body>

<div class="scene">
    <div class="pyramid" id="pyramid">
        <img src="azul-tactical.png" id="azul">
    </div>
</div>

<script>
const cubeSize = 50;
const levels = 5;

const pyramid = document.getElementById("pyramid");
const azul = document.getElementById("azul");
const bgMusic = new Audio("a-sunny-day.mp3");
bgMusic.loop = true;

let isMuted = false;

/* BUILD TRUE 3D PYRAMID */
for(let r=0;r<levels;r++){
    for(let c=0;c<=r;c++){

        const wrap = document.createElement("div");
        wrap.className="cube-wrapper";
        wrap.dataset.compiled="false";

        const x = (c - r/2) * cubeSize;
        const y = r * cubeSize;
        const z = -r * cubeSize;

        wrap.style.transform = `
            translate3d(${x}px,${y}px,${z}px)
        `;

        wrap.innerHTML=`
            <div class="cube top"></div>
            <div class="cube left"></div>
            <div class="cube right"></div>
        `;

        wrap.addEventListener("click",()=>handleHop(wrap));

        pyramid.appendChild(wrap);
    }
}

/* CENTER PYRAMID */
pyramid.style.transform = "translate(-50%,-50%)";

/* HANDLE HOP */
function handleHop(target){

    if(bgMusic.paused && !isMuted){
        bgMusic.play().catch(()=>{});
    }

    // If already compiled, ignore
    if(target.dataset.compiled === "true") return;

    // Move Azul first
    azul.style.transform = target.style.transform + " translateZ(65px)";

    // Start glitch
    target.classList.add("glitch");
    if (navigator.vibrate) navigator.vibrate([30, 30, 30]);
    setTimeout(()=>{
        target.classList.remove("glitch");
        target.classList.add("compiled");
        target.dataset.compiled = "true";
    }, 400);
}

/* SIMPLE AUDIO UNLOCK */
window.addEventListener("touchstart",()=>{
    bgMusic.play().then(()=>{
        bgMusic.pause();
        bgMusic.currentTime=0;
    }).catch(()=>{});
},{once:true});

/* OPTIONAL MUTE TOGGLE */
document.addEventListener("keydown",(e)=>{
    if(e.key==="m"){
        isMuted=!isMuted;
        bgMusic.muted=isMuted;
    }
});
</script>

</body>
</html>
