<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>THE Q-CODE</title>

<style>
:root{
    --neon-cyan:#00ffff;
    --neon-pink:#ff00ff;
    --corrupted:#ff0055;
}

body{
    margin:0;
    background:#000;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    perspective:1200px;
    font-family:monospace;
    color:var(--neon-cyan);
}

/* ROTATING WORLD */
.scene{
    width:400px;
    height:400px;
    position:relative;
    transform-style:preserve-3d;
    animation: spin 20s linear infinite;
}

@keyframes spin{
    from{ transform: rotateX(60deg) rotateY(0deg); }
    to{ transform: rotateX(60deg) rotateY(360deg); }
}

.pyramid{
    position:absolute;
    top:50%;
    left:50%;
    transform-style:preserve-3d;
}

/* CUBES */
.cube-wrapper{
    position:absolute;
    width:50px;
    height:50px;
    transform-style:preserve-3d;
    transition:transform .3s ease;
}

.cube{
    position:absolute;
    width:50px;
    height:50px;
    backface-visibility:hidden;
}

.top{
    background:var(--corrupted);
    transform:translateZ(50px);
    border:1px solid #fff;
}

.left{
    background:#990033;
    transform:rotateY(-90deg) translateZ(25px);
    transform-origin:left;
}

.right{
    background:#660022;
    transform:rotateX(-90deg) translateZ(25px);
    transform-origin:bottom;
}

.compiled .top{
    background:var(--neon-cyan)!important;
    box-shadow:0 0 20px var(--neon-cyan);
}

/* AZUL */
#azul{
    position:absolute;
    width:60px;
    pointer-events:none;
    transition:transform .3s cubic-bezier(.2,1,.3,1);
}
</style>
</head>
<body>

<div class="scene">
    <div class="pyramid" id="pyramid">
        <img src="azul-tactical.png" id="azul">
    </div>
</div>

<script>
const cubeSize = 50;
const levels = 5;

const pyramid = document.getElementById("pyramid");
const azul = document.getElementById("azul");
const bgMusic = new Audio("a-sunny-day.mp3");
bgMusic.loop = true;

let isMuted = false;

/* BUILD TRUE 3D PYRAMID */
for(let r=0;r<levels;r++){
    for(let c=0;c<=r;c++){

        const wrap = document.createElement("div");
        wrap.className="cube-wrapper";
        wrap.dataset.compiled="false";

        const x = (c - r/2) * cubeSize;
        const y = r * cubeSize;
        const z = -r * cubeSize;

        wrap.style.transform = `
            translate3d(${x}px,${y}px,${z}px)
        `;

        wrap.innerHTML=`
            <div class="cube top"></div>
            <div class="cube left"></div>
            <div class="cube right"></div>
        `;

        wrap.addEventListener("click",()=>handleHop(wrap));

        pyramid.appendChild(wrap);
    }
}

/* CENTER PYRAMID */
pyramid.style.transform = "translate(-50%,-50%)";

/* HANDLE HOP */
function handleHop(target){

    if(bgMusic.paused && !isMuted){
        bgMusic.play().catch(()=>{});
    }

    target.classList.toggle("compiled");

    azul.style.transform = target.style.transform +
        " translateZ(70px)";
}

/* SIMPLE AUDIO UNLOCK */
window.addEventListener("touchstart",()=>{
    bgMusic.play().then(()=>{
        bgMusic.pause();
        bgMusic.currentTime=0;
    }).catch(()=>{});
},{once:true});

/* OPTIONAL MUTE TOGGLE */
document.addEventListener("keydown",(e)=>{
    if(e.key==="m"){
        isMuted=!isMuted;
        bgMusic.muted=isMuted;
    }
});
</script>

</body>
</html>
